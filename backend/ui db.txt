-- CREATE DATABASE
CREATE DATABASE IF NOT EXISTS water_billing_db;
USE water_billing_db;

-- DROP ALL TABLES IF THEY EXIST (fresh import)
DROP TABLE IF EXISTS audit_logs, payments, billings, meter_readings, forecasts, households, users, rates;

-- USERS TABLE
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,              -- optimized length for bcrypt/argon2
    role ENUM('Admin', 'Staff', 'Consumer') NOT NULL,
    full_name VARCHAR(100),
    email VARCHAR(100) UNIQUE,                        -- ensure unique email
    secondary_email VARCHAR(100) UNIQUE NULL,          -- optional secondary email
    contact_number VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login DATETIME NULL,                         -- for monitoring activity
    failed_attempts INT DEFAULT 0,                    -- brute force protection
    lockout_until DATETIME NULL                       -- temporary lockout window
);

-- HOUSEHOLDS TABLE
CREATE TABLE households (
    household_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    meter_number VARCHAR(20) UNIQUE,
    address VARCHAR(255),                             -- changed from TEXT for efficiency
    barangay VARCHAR(100),                            -- optional geo subdivision
    tap_number VARCHAR(10),
    registered_date DATE,
    active_status ENUM('Active', 'Disconnected') DEFAULT 'Active',
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

-- METER READINGS TABLE
CREATE TABLE meter_readings (
    reading_id INT AUTO_INCREMENT PRIMARY KEY,
    household_id INT,
    reading_date DATE,
    previous_reading INT,
    current_reading INT,
    consumption INT,
    image_path VARCHAR(255),                          -- optimized path storage
    FOREIGN KEY (household_id) REFERENCES households(household_id),
    CHECK (current_reading >= previous_reading)       -- prevent negative usage
);

-- RATES TABLE
CREATE TABLE rates (
    rate_id INT AUTO_INCREMENT PRIMARY KEY,
    effective_date DATE,
    base_rate DECIMAL(5,2),
    base_cubic INT,
    excess_rate DECIMAL(5,2),
    active ENUM('Yes','No') DEFAULT 'Yes'             -- track valid/obsolete rates
);

-- BILLINGS TABLE
CREATE TABLE billings (
    billing_id INT AUTO_INCREMENT PRIMARY KEY,
    household_id INT,                                 -- direct link for faster reporting
    reading_id INT,
    rate_id INT,
    billing_date DATE,
    total_consumption INT,
    amount_due DECIMAL(10,2),
    due_date DATE,
    billing_status ENUM('Unpaid', 'Paid', 'Overdue') DEFAULT 'Unpaid',
    base_charge DECIMAL(10,2),
    excess_cubic INT,
    excess_charge DECIMAL(10,2),
    payment_id INT NULL,                              -- optional direct reference to payment
    FOREIGN KEY (household_id) REFERENCES households(household_id),
    FOREIGN KEY (reading_id) REFERENCES meter_readings(reading_id),
    FOREIGN KEY (rate_id) REFERENCES rates(rate_id)
);

CREATE TABLE payments (
    payment_id INT AUTO_INCREMENT PRIMARY KEY,
    billing_id INT NOT NULL,
    payment_date DATETIME DEFAULT CURRENT_TIMESTAMP,  -- auto timestamp
    amount_paid DECIMAL(10,2) NOT NULL,
    payment_method ENUM('GCash', 'Face-to-Face') NOT NULL,
    transaction_reference VARCHAR(100),               -- GCash ref or OR number
    proof_image VARCHAR(255) NULL,                    -- GCash screenshot upload
    status ENUM('Pending Validation', 'Validated', 'Rejected') DEFAULT 'Pending Validation',
    validated_by INT NULL,                            -- admin/staff who verified
    receipt_path VARCHAR(255) NULL,                   -- optional PDF receipt
    FOREIGN KEY (billing_id) REFERENCES billings(billing_id),
    FOREIGN KEY (validated_by) REFERENCES users(user_id)
);

-- FORECASTS TABLE (Unified for Admin, Staff, Consumers)
CREATE TABLE forecasts (
    forecast_id INT AUTO_INCREMENT PRIMARY KEY,
    household_id INT,
    forecast_type ENUM('Usage', 'Revenue', 'Bills', 'Accounts') NOT NULL,
    forecast_date DATE NOT NULL,
    predicted_value DECIMAL(10,2) NOT NULL,
    actual_value DECIMAL(10,2),
    model_used VARCHAR(50),
    evaluation_metric VARCHAR(20),
    metric_value DECIMAL(10,4),
    created_by INT,                                   -- user_id of admin/staff who ran forecast
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (household_id) REFERENCES households(household_id),
    FOREIGN KEY (created_by) REFERENCES users(user_id)
);

-- AUDIT LOGS TABLE (ISO-ready)
CREATE TABLE audit_logs (
    log_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NULL,                                 -- known user
    username VARCHAR(50),                             -- username (even if failed login)
    role ENUM('Admin','Staff','Consumer') NULL,       -- role if available
    ip_address VARCHAR(45),                           -- IPv4/IPv6
    user_agent TEXT,                                  -- browser/device
    action_type ENUM('Login','Logout','Create','Update','Delete','View','System','Other'),
    action_detail TEXT,                               -- e.g. "Failed login: wrong password"
    affected_table VARCHAR(50) NULL,                  -- e.g. 'users', 'billings'
    affected_id INT NULL,                             -- e.g. 12 (user_id/billing_id/etc.)
    status ENUM('Success','Failure','Warning') DEFAULT 'Success',
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);


CREATE TABLE password_resets (
    reset_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    token VARCHAR(255) NOT NULL,
    expires_at DATETIME NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);

CREATE TABLE notifications (
    notification_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    message TEXT NOT NULL,
    type ENUM('Payment','Billing','System') DEFAULT 'System',
    status ENUM('Unread','Read') DEFAULT 'Unread',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE gcash_settings (
  id INT AUTO_INCREMENT PRIMARY KEY,
  gcash_name VARCHAR(100),
  gcash_number VARCHAR(50),
  qr_image VARCHAR(255),
  updated_by INT,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (updated_by) REFERENCES users(user_id)
);



Thanks for sharing the updated logo! Based on the logo‚Äôs current colors:

* üî¥ **Red (BAWASA wordmark)** ‚Äî energetic and eye-catching
* üîµ **Aqua Blue (background circle)** ‚Äî clean, water-based
* üîµ **Dark Blue (subtext ‚ÄúBarangay Water System Association‚Äù)** ‚Äî professional, readable

You‚Äôve already followed a **60-30-10 style** pretty well! So for your **system (UI color scheme)** ‚Äî such as website/app/dashboard ‚Äî here‚Äôs a matching set that works beautifully with your logo:

---

## ‚úÖ Suggested Color Scheme for the BAWASA System

### üé® 1. **Primary (60%) ‚Äì Background/Base Color**

* **Very Light Aqua / White Tint**: #E6FBFF or #F9FCFD

  * Use for backgrounds, cards, and clean space.
  * Keeps the interface airy and consistent with the blue tone of your logo.

### üé® 2. **Secondary (30%) ‚Äì Accent and Component Color**

* **Deep Navy Blue**: #003B73

  * For navbar, titles, buttons, charts, and structural UI.
  * Adds seriousness and trust (especially for a public utility).

### üé® 3. **Accent (10%) ‚Äì Action & Highlights**

* **Coral Red**: #E63946 or use the exact red in your logo

  * For ‚ÄúPay Now‚Äù, ‚ÄúSubmit‚Äù, alert icons, links, or important notices.
  * Matches your ‚ÄúBAWASA‚Äù title and catches attention instantly.

---


Poppins ‚Äì üíØ Top Choice
Why: Rounded, modern, and clean ‚Äî matches the soft aqua and coral accents

Pairing:

Poppins Bold for headers/buttons (matches well with coral #E63946)

Poppins Regular for body text (pairs cleanly with aqua/white backgrounds)

It gives off a government-service + modern community platform feel ‚Äî perfect for BAWASA.

| UI Element      | Font                | Weight    | Suggested Color |
| --------------- | ------------------- | --------- | --------------- |
| Titles/Headers  | Poppins Bold        | 700     | #003B73       |
| Body Text       | Poppins Regular     | 400     | #003B73       |
| Buttons/CTAs    | Poppins SemiBold    | 600     | #E63946       |
| Subtext/Labels  | Poppins Light       | 300-400 | #003B73       |
| Background Text | Any (lower opacity) | ‚Äî         | #003B73 @ 60% |


 

## üß† Optional Supporting Colors (Neutral UI Helpers)

| Purpose             | Color          | Hex       |
| ------------------- | -------------- | --------- |
| Light text / labels | Cool Gray      | #6E7D8B |
| Border / line       | Pale Blue Gray | #DCECF2 |
| Success             | Teal Green     | #2ECC71 |
| Warning             | Orange         | #F39C12 |

---

## üß© Example Application in the System

| UI Element            | Color                                    |
| --------------------- | ---------------------------------------- |
| Sidebar               | Navy Blue (#003B73) with white icons   |
| Buttons               | Aqua Blue for default, Coral Red for CTA |
| Background            | Very light aqua (#E6FBFF)              |
| Charts                | Blue tones with Coral Red for key values |
| Hover / Active States | Lighter shade of blue                    |

---






















project/                       <-- project root
‚îú‚îÄ frontend/                       <-- PHP app files (place under htdocs or web root)
‚îÇ  ‚îú‚îÄ db.php                  <-- DB connection + helper functions
‚îÇ  ‚îú‚îÄ auth.php                <-- login/logout/session helpers
‚îÇ  ‚îú‚îÄ login.php                <-- login page (POST -> authenticate)
‚îÇ  ‚îú‚îÄ logout.php                <-- login page (POST -> authenticate)
‚îÇ  ‚îú‚îÄ resetPassword.php                <-- login page (POST -> authenticate)
‚îÇ  ‚îú‚îÄ index.php               <-- redirection for login page
‚îÇ  ‚îú‚îÄ admin/
‚îÇ  ‚îÇ  ‚îú‚îÄ adminAddReadings.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminAddReceipt.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminAuditLogs.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminDashboard.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminEditProfile.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminEditUser.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminGcashPayment.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminManagerReceipts.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminManageUsers.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminPayment.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminProfile.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminReadMeterFile.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminRegisterUser.php
‚îÇ  ‚îÇ  ‚îú‚îÄ adminReports.php
‚îÇ  ‚îÇ  ‚îî‚îÄ syncReadings.php
‚îÇ  ‚îú‚îÄ staff/
‚îÇ  ‚îÇ  ‚îú‚îÄ staffAddReadings.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffAddReceipt.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffDashboard.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffEditProfile.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffGcashPayment.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffManagePayments.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffManageReceipts.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffPaymentsHistory.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffProfile.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffReadMeterFile.php
‚îÇ  ‚îÇ  ‚îú‚îÄ staffReports.php
‚îÇ  ‚îÇ  ‚îú‚îÄ syncReadings.php
‚îÇ  ‚îú‚îÄ consumer/
‚îÇ  ‚îÇ  ‚îú‚îÄ consumerAddEmail.php
‚îÇ  ‚îÇ  ‚îú‚îÄ consumerBillings.php
‚îÇ  ‚îÇ  ‚îú‚îÄ consumerDashboard.php
‚îÇ  ‚îÇ  ‚îú‚îÄ consumerEditProfile.php
‚îÇ  ‚îÇ  ‚îú‚îÄ consumerPayments.php
‚îÇ  ‚îÇ  ‚îú‚îÄ consumerProfile.php
‚îÇ  ‚îÇ  ‚îî‚îÄ consumerReceipts.php

‚îÇ  ‚îú‚îÄ api/
‚îÇ  ‚îÇ  ‚îî‚îÄ forecasts.php      <-- PHP -> calls Python forecasting API
‚îÇ  ‚îî‚îÄ assets/
‚îÇ     ‚îú‚îÄ css/style.css      <-- the css should be inline with the codes
‚îÇ     ‚îî‚îÄ js/app.js
‚îú‚îÄ python_forecast/
‚îÇ  ‚îú‚îÄ forecast_api.py        <-- Flask + SARIMAX REST service
‚îÇ  ‚îî‚îÄ requirements.ipynb    
‚îî‚îÄ README.md






all of the pages above already have codes next are make it a responsive to all devices display and make sure that the dashboard of each role is working

the above things are the requirements for my system next is the language that is used in the system php, js, html, bootstrap, css for the ui and responsiveness and python for the dashboard